{"version":3,"file":"example.js","sources":["../../src/utils.js","../../src/index.js","../index.js"],"sourcesContent":["export default {\n    extend(obj1, obj2) {\n        for (let k in obj2) {\n            if (obj2.hasOwnProperty(k)) {\n                if (typeof obj2[k] == 'object') {\n                    if (typeof obj1[k] !== 'object' || obj1[k] === null) {\n                        obj1[k] = {};\n                    }\n                    this.extend(obj1[k], obj2[k]);\n                } else {\n                    obj1[k] = obj2[k];\n                }\n            }\n        }\n        return obj1;\n    },\n    loadImage(image, loaded, error) {\n        let img = new Image();\n        if(image.indexOf('http') == 0){\n            img.crossOrigin = '*';\n        }\n        img.onload = () => {\n            loaded(img);\n        };\n        img.onerror = () => {\n            error('img load error');\n        };\n        img.src = image;\n    },\n    isArr(arr) {\n        return Object.prototype.toString.call(arr) === '[object Array]';\n    },\n    getImage(image,cbk){\n        if(typeof image == 'string'){\n                this.loadImage(image, img => {\n                    cbk(img);\n                },err=>{\n                    console.log(err);\n                });\n        }else if(typeof image == 'object'){\n            cbk(image);\n        }else{\n            console.log('add image error');\n            return;\n        }\n    },\n    forin(obj,cbk){\n        for(let k in obj){\n            if(obj.hasOwnProperty(k)){\n                cbk(k,obj[k]);\n            }\n        }\n    },\n    isIos8(){\n        let UA = window.navigator.userAgent.toLowerCase();\n        let IOS = /(iPhone|iPad|iPod|iOS)/gi.test(UA);\n        let IPAD = /(iPad)/gi.test(UA);\n        if(IOS){\n            return IPAD ? UA.match(/cpu os (\\d*)/)[1] < 9 : UA.match(/iphone os (\\d*)/)[1] < 9;\n        }else{\n            return false;\n        }\n    },\n};\n","import _ from './utils';\n\nexport default function MCanvas(cwidth,cheight,backgroundColor){\n\n    // 兼容不使用 new 的方式；\n    if (!(this instanceof MCanvas))\n        return new MCanvas(cwidth,cheight,backgroundColor);\n\n    // 配置canvas初始大小；\n    // cwidth：画布宽度，Number,选填，默认为 500;\n    // cheight: 画布高度，Number，选填，默认与宽度一致；\n    this.ops = {\n        width: cwidth || 500,\n        height:cheight || cwidth,\n        backgroundColor,\n    };\n    // 全局画布；\n    this.canvas = null;\n    this.ctx = null;\n\n    // 绘制函数队列；\n    this.queue = [];\n    // 最后执行的函数；\n    this.end = null;\n\n    // 文字绘制数据；\n    this.textData = {};\n\n    // 背景图数据;\n    this.bgConfig = null;\n\n    // 初始化创建画布；\n    this._init();\n}\n\nMCanvas.prototype._init = function(){\n    this.canvas = document.createElement('canvas');\n    this.canvas.width = this.ops.width;\n    this.canvas.height = this.ops.height;\n    this.ctx = this.canvas.getContext('2d');\n    if(this.ops.backgroundColor){\n        this.ctx.fillStyle = this.ops.backgroundColor;\n        this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n    }\n};\n\n// --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\nMCanvas.prototype.background = function(image,bg){\n    if(!bg && !image){\n        if(this.bgConfig){\n            bg = this.bgConfig;\n        }else{\n            console.error('mcanvas error : the init background must has the bg option params.');\n            return;\n        }\n    }else{\n        bg.image = image;\n        this.bgConfig = bg;\n    }\n    this.queue.push(() => {\n        if(bg.color){\n            this.ctx.fillStyle = bg.color;\n            this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);\n        }\n        if(bg.image){\n            _.getImage(bg.image, img =>{\n                this._background(img,bg);\n            });\n        }else{\n            console.error('mcanvas error : background image error!');\n        }\n    });\n    return this;\n};\n\nMCanvas.prototype._getBgAlign = function(left,iw,cw,cropScale){\n    let rv;\n    if(typeof left == 'string'){\n        if(left == '50%' || left == 'center'){\n            rv = Math.abs((iw - cw / cropScale) / 2);\n        }else if(left == '100%'){\n            rv = Math.abs(iw - cw / cropScale);\n        }else if(left == '0%'){\n            rv = 0;\n        }\n    }else if(typeof left == 'number'){\n        rv = left;\n    }else{\n        rv = 0;\n    }\n    return rv;\n};\nMCanvas.prototype._background = function(img,bg){\n    let {iw,ih} = this._getSize(img);\n    // 图片与canvas的长宽比；\n    let iRatio = iw / ih;\n    let cRatio = this.canvas.width / this.canvas.height;\n    // 背景绘制参数；\n    let sx,sy,swidth,sheight,dx,dy,dwidth,dheight;\n    let cropScale;\n    switch (bg.type) {\n        // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n        case 'crop':\n            if(iRatio > cRatio){\n                swidth = ih * cRatio;\n                sheight = ih;\n                cropScale = this.canvas.height / ih;\n            }else{\n                swidth = iw;\n                sheight = swidth / cRatio;\n                cropScale = this.canvas.width / iw;\n            }\n\n            sx = this._getBgAlign(bg.left,iw, this.canvas.width,cropScale);\n            sy = this._getBgAlign(bg.top,ih,this.canvas.height,cropScale);\n\n            dy = dx = 0;\n            dheight = this.canvas.height;\n            dwidth = this.canvas.width;\n            break;\n        // 包含模式，固定canvas大小，包含背景图；\n        case 'contain':\n            sy = sx = 0;\n            swidth = iw;\n            sheight = ih;\n            if(iRatio > cRatio){\n                dwidth = this.canvas.width;\n                dheight = dwidth / iRatio;\n                dx = bg.left || 0;\n                dy = (bg.top || bg.top == 0) ? bg.top : (this.canvas.height - dheight)/2;\n            }else{\n                dheight = this.canvas.height;\n                dwidth = dheight * iRatio;\n                dy = bg.top || 0;\n                dx = (bg.left || bg.left == 0) ? bg.left : (this.canvas.width - dwidth)/2;\n            }\n            break;\n        // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n        // 同时，background 传入的 left/top 均被忽略；\n        case 'origin':\n            this.canvas.width = iw;\n            this.canvas.height = ih;\n            sx = sy = 0;\n            swidth = iw;\n            sheight = ih;\n            dx = dy = 0;\n            dwidth = this.canvas.width;\n            dheight = this.canvas.height;\n            break;\n        default:\n            console.error('mcanvas error:background type error!');\n    }\n    this.ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight);\n    this._next();\n};\n// --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n\n// 绘制水印；基于 add 函数封装；\nMCanvas.prototype.watermark = function(image = '',ops){\n    if(!image){\n        console.error('mcanvas error : there is not image of watermark.');\n        return;\n    }\n    // 参数默认值；\n    let { width = '40%' , pos = 'rightbottom' , margin = 20} = ops;\n    let position = {\n        x:0,\n        y:0,\n        scale:1,\n        rotate:0,\n    };\n    switch (pos) {\n        case 'leftTop':\n            position.x = `left:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'leftBottom':\n            position.x = `left:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        case 'rightTop':\n            position.x = `right:${margin}`;\n            position.y = `top:${margin}`;\n            break;\n        case 'rightBottom':\n            position.x = `right:${margin}`;\n            position.y = `bottom:${margin}`;\n            break;\n        default:\n    }\n    this.add(image,{\n        width,\n        pos:position,\n    });\n    return this;\n};\n\n// 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\nMCanvas.prototype.add = function(image = '',options){\n    // 默认参数；\n    let def = {\n        width:'100%',\n        crop:{\n            x:0,\n            y:0,\n            width:'100%',\n            height:'100%',\n        },\n        pos:{\n            x:0,\n            y:0,\n            scale:1,\n            rotate:0,\n        },\n    };\n\n    if(!_.isArr(image))image = [{image,options}];\n\n    image.forEach( v =>{\n        // 将封装好的 add函数 推入队列中待执行；\n        // 参数经过 _handleOps 加工；\n        this.queue.push(() => {\n            _.getImage(v.image, img => {\n                this._add(img,this._handleOps(_.extend(def,v.options),img));\n            });\n        });\n    });\n\n    return this;\n};\n\nMCanvas.prototype._add = function(img,ops){\n    if(ops.width==0)console.warn(`mcanvas warn: the width of mc-element is zero`);\n    let {iw,ih} = this._getSize(img);\n    // let ratio = iw / ih;\n    // 画布canvas参数；\n    let cdx,cdy,cdw,cdh;\n    // 素材canvas参数；\n    let { x:lsx, y:lsy, width:lsw, height:lsh} = ops.crop;\n\n    let cratio = lsw / lsh;\n    let ldx,ldy,ldw,ldh;\n    // 素材canvas的绘制;\n    let lcvs = document.createElement('canvas');\n    let lctx = lcvs.getContext('2d');\n    // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n    // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n    // _ratio 为 较大边 / 较小编 的比例；\n    let _ratio = iw > ih ? iw / ih : ih / iw;\n    let lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4;\n    let spaceX,spaceY;\n\n    lcvs.width =  lsw * lctxScale;\n    lcvs.height = lsh * lctxScale;\n\n    // 限制canvas的大小，ios8以下为 2096, 其余平台均限制为 4096;\n    let shrink;\n    if(_.isIos8() && (lcvs.width > 2096 || lcvs.height > 2096)){\n        if(cratio > 1){\n            shrink = 2096 / lcvs.width;\n        }else{\n            shrink = 2096 / lcvs.height;\n        }\n    }else if(lcvs.width > 4096 || lcvs.height > 4096){\n        if(cratio > 1){\n            shrink = 4096 / lcvs.width;\n        }else{\n            shrink = 4096 / lcvs.height;\n        }\n    }\n\n    // 从素材canvas的中心点开始绘制；\n    ldx = - Math.round(lsw / 2);\n    ldy = - Math.round(lsh / 2);\n    ldw = lsw;\n    ldh = Math.round(lsw / cratio);\n\n    // 获取素材最终的宽高;\n    if(shrink){\n        [lcvs.width,lcvs.height,ldx,ldy,ldw,ldh] = [lcvs.width,lcvs.height,ldx,ldy,ldw,ldh].map( v => Math.round(v*shrink));\n    }\n\n    lctx.translate(lcvs.width/2,lcvs.height/2);\n    lctx.rotate(ops.pos.rotate);\n\n    lctx.drawImage(img,lsx,lsy,lsw,lsh,ldx,ldy,ldw,ldh);\n\n    // lcvs.style.width = '300px';\n    // document.querySelector('body').appendChild(lcvs);\n\n    cdw = ops.width * lctxScale;\n    cdh = cdw / cratio;\n\n    spaceX = (lctxScale - 1) * ops.width / 2;\n    spaceY = spaceX / cratio;\n\n    // 获取素材的位置；\n    //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n    cdx = ops.pos.x + cdw * ( 1 - ops.pos.scale )/2 - spaceX;\n    cdy = ops.pos.y + cdh * ( 1 - ops.pos.scale )/2 - spaceY;\n\n    cdw *= ops.pos.scale;\n    cdh *= ops.pos.scale;\n\n    this.ctx.drawImage(lcvs,cdx,cdy,cdw,cdh);\n\n    lcvs = lctx = null;\n    this._next();\n};\n\n// 获取宽高，兼容img，canvas\nMCanvas.prototype._getSize = function(img){\n    let iw,\n        ih;\n    if(img.tagName === 'IMG'){\n        iw = img.naturalWidth;\n        ih = img.naturalHeight;\n    }else if(img.tagName === 'CANVAS'){\n        iw = img.width;\n        ih = img.height;\n    }else{\n        iw = img.offsetWidth;\n        ih = img.offsetHeight;\n    }\n    return{iw,ih};\n};\n// 参数加工函数；\nMCanvas.prototype._handleOps = function(ops,img){\n    let cw = this.canvas.width,\n        ch = this.canvas.height;\n    let {iw,ih} = this._getSize(img);\n\n    // 图片宽高比；\n    let ratio = iw / ih;\n\n    // 根据参数计算后的绘制宽度；\n    let width =  this._get(cw,iw,ops.width,'pos');\n\n    // 裁剪的最大宽高；\n    let maxLsw,maxLsh;\n\n    // 裁剪参数；\n    let { x:cropx,y:cropy,width:cropw,height:croph } = ops.crop;\n    let crop = {};\n    crop.width = this._get(cw,iw,cropw,'crop');\n    crop.height = this._get(ch,ih,croph,'crop');\n    crop.x = this._get(iw,crop.width,cropx,'crop');\n    crop.y = this._get(ih,crop.height,cropy,'crop');\n\n    // 最大值判定；\n    if(crop.x > iw)crop.x = iw;\n    if(crop.y > ih)crop.y = ih;\n    maxLsw = iw - crop.x;\n    maxLsh = ih - crop.y;\n    if(crop.width > maxLsw)crop.width = maxLsw;\n    if(crop.height > maxLsh)crop.height = maxLsh;\n\n    // 位置参数；\n    let { x: px, y: py, rotate: pr, scale: ps } = ops.pos;\n    let pos = {\n        x:this._get(cw,width,px,'pos'),\n        y:this._get(ch,width/ratio,py,'pos'),\n        scale : ps,\n        rotate : parseFloat(pr) * Math.PI / 180,\n    };\n    return {width,crop,pos};\n};\n\n// --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\nMCanvas.prototype.text = function(context = '', ops){\n    // 默认字体；\n    let fontFamily = `helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif`;\n    // 默认的字体大小;\n    let size = this.canvas.width / 20;\n\n    this.queue.push(()=>{\n        let option = {\n            width : 300,\n            align : 'left',\n            smallStyle:{\n                font : `${size * 0.8}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 0.9,\n            },\n            normalStyle:{\n                font : `${size }px ${fontFamily}`,\n                color:'#000',\n                lineheight:size*1.1,\n            },\n            largeStyle:{\n                font : `${size * 1.3}px ${fontFamily}`,\n                color:'#000',\n                lineheight:size * 1.4,\n            },\n            pos:{\n                x:0,\n                y:0,\n            },\n        };\n        option = _.extend(option,ops);\n\n        // 解析字符串模板后，调用字体绘制函数；\n        this._text(this._parse(context),option);\n        this._next();\n    });\n    return this;\n};\n// 字符串模板解析函数\n// 解析 <s></s> <b></b>\nMCanvas.prototype._parse = function(context){\n    let arr = context.split(/<s>|<b>/);\n    let result = [];\n    for(let i=0;i<arr.length;i++){\n        let value = arr[i];\n        if(/<\\/s>|<\\/b>/.test(value)){\n            let splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n                type     = /<\\/s>/.test(value) ? 'small' : 'large';\n            let tmp = arr[i].split(splitTag);\n            result.push({\n                type:type,\n                text:tmp[0],\n            });\n            tmp[1] && result.push({\n                type:'normal',\n                text:tmp[1],\n            });\n            continue;\n        }\n        arr[i] && result.push({\n            text:arr[i],\n            type:'normal',\n        });\n    }\n    return result;\n};\n\nMCanvas.prototype._text = function(textArr,option){\n    // 处理宽度参数；\n    option.width = this._get(this.canvas.width,0,option.width,'pos');\n\n    let style,line = 1,length = 0,\n        lineheight = getLineHeight(textArr,option),\n        x = this._get(this.canvas.width,option.width,option.pos.x,'pos'),\n        y = (this._get(this.canvas.height,0,option.pos.y,'pos')) + lineheight;\n\n    // data:字体数据；\n    // lineWidth:行宽；\n    this.textData[line] = {\n        data:[],\n        lineWidth:0,\n    };\n\n    // 生成字体数据；\n    textArr.forEach(v =>{\n        style = option[`${v.type}Style`];\n        this.ctx.font = style.font;\n        let width = this.ctx.measureText(v.text).width;\n\n        // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n        let context = v.text.replace(/<br>/g,'|');\n\n        // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n        if((length + width) > option.width || context.indexOf('|') !== -1){\n            for (let i=0,fontLength = context.length; i < fontLength; i++) {\n                let font = context[i];\n                width = this.ctx.measureText(font).width;\n\n                // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n                if((length + width) > option.width || font == '|'){\n                    length = 0;\n                    x = this._get(this.canvas.width,option.width,option.pos.x,'pos');\n                    y += lineheight;\n                    line += 1;\n                    this.textData[line] = {\n                        data:[],\n                        lineWidth:0,\n                    };\n                    if(font == '|')continue;\n                }\n                this.textData[line]['data'].push({\n                    context:font,x,y,style,width,\n                });\n                length += width;\n                x += width;\n                this.textData[line]['lineWidth'] = length;\n            }\n        }else{\n            this.textData[line]['data'].push({\n                context,x,y,style,width,\n            });\n            length += width;\n            x += width;\n            this.textData[line]['lineWidth'] = length;\n        }\n    });\n\n    // 通过字体数据进行文字的绘制；\n    _.forin(this.textData,(k,v)=>{\n        // \b增加 align 的功能；\n        let add = 0;\n        if(v.lineWidth < option.width){\n            if(option.align == 'center'){\n                add = (option.width - v.lineWidth)/2;\n            }else if (option.align == 'right') {\n                add = option.width - v.lineWidth;\n            }\n        }\n        v.data.forEach(text=>{\n            text.x += add;\n            this._fillText(text);\n        });\n    });\n\n    // 获取行高；\n    function getLineHeight(textArr,option) {\n        let lh = 0,vlh;\n        textArr.forEach( v =>{\n            vlh = option[`${v.type}Style`].lineheight;\n            if(vlh > lh)lh = vlh;\n        });\n        return lh;\n    }\n};\nMCanvas.prototype._fillText = function(text){\n    let {context,x,y,style} = text;\n    this.ctx.font = style.font;\n    this.ctx.textAlign = style.align;\n    this.ctx.textBaseline = 'bottom';\n    this.ctx.fillStyle = style.color;\n    this.ctx.fillText(context,x,y);\n};\n\n// --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\nMCanvas.prototype._get = function(par,child,str,type){\n    let result = str;\n    if(typeof str === 'string'){\n        if(str.indexOf(':') !== -1 && type == 'pos'){\n            let arr = str.split(':');\n            switch (arr[0]) {\n                case 'left':\n                case 'top':\n                    result = +(arr[1].replace('px',''));\n                    break;\n                case 'right':\n                case 'bottom':\n                    result = par - (+(arr[1].replace('px',''))) - child;\n                    break;\n                default:\n            }\n        }else if (str.indexOf('px') !== -1) {\n            result = (+str.replace('px', ''));\n        } else if (str.indexOf('%') !== -1) {\n            if(type == 'crop'){\n                result = child * (+str.replace('%', '')) / 100;\n            }else{\n                result = par * (+str.replace('%', '')) / 100;\n            }\n        }else if(str == 'center'){\n            result = (par-child)/2;\n        }else{\n            result = +str;\n        }\n    }\n    return Math.round(result);\n};\n\n// 绘制函数；\nMCanvas.prototype.draw = function(ops){\n    let b64;\n    let _ops = {\n        type:'png',\n        quality:.9,\n        callback(){},\n    };\n    if(typeof ops == 'function'){\n        _ops.callback = ops;\n    }else{\n        _ops = _.extend(_ops,ops);\n        if(_ops.type == 'jpg')_ops.type = 'jpeg';\n    }\n    this.end = () => {\n        setTimeout(()=>{\n            b64 = this.canvas.toDataURL(`image/${_ops.type}`, _ops.quality);\n            _ops.callback(b64);\n        },0);\n    };\n    this._next();\n    return this;\n};\nMCanvas.prototype._next = function(){\n    if(this.queue.length > 0){\n        this.queue.shift()();\n    }else{\n        this.end();\n    }\n};\n\nMCanvas.prototype.clear = function(){\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    return this;\n};\n","import MCanvas from '../src/index';\n\nlet $sure = $('.js-sure');\nlet $params = $('.js-params');\nlet $dialog = $('.js-dialog');\nlet $result = $('.js-result');\nlet $cancel = $('.js-cancel');\nlet $clear = $('.js-clear');\n\nlet data = {\n    addImageOps : {\n        image:'./images/ear.png',\n        // image:'https://mtapplet.meitudata.com/59c8c479521876738.jpg',\n        options:{\n            width:482,\n            pos:{\n                x:150,\n                y:58,\n                scale:1,\n                rotate:1,\n            },\n        },\n    },\n    addWmOps : {\n        image:'images/watermark.jpg',\n        options:{\n            width:'40%',\n            pos:'rightBottom',\n        },\n    },\n    addTextOps : {\n        text:'<b>美图</b>前端组啊啊啊啊<s>MCanvas.js</s>',\n        options:{\n            width:'200',\n            align:'left',\n            largeStyle:{\n                color:'red',\n            },\n            normalStyle:{\n                color:'blue',\n            },\n            smallStyle:{\n                color:'yellow',\n            },\n            pos:{\n                x:'center',\n                y:'bottom:200',\n            },\n        },\n    },\n};\n\nlet mc = new MCanvas(1000,1500,'black');\nmc.background('http://mtapplet.meitudata.com/596c72073971d86b5128.jpg',{\n// mc.background('http://mtapplet.meitudata.com/59e8765b6492c541.jpg',{\n    type:'origin',\n    left:'50%',\n    top:'50%',\n});\n\nlet timer;\n$('.Button').on('touchstart',function(){\n    $(this).addClass('taped');\n    timer = setTimeout(()=>{\n        $(this).removeClass('taped');\n    },2000);\n});\n$('.Button').on('touchend',function(){\n    $(this).removeClass('taped');\n    clearTimeout(timer);\n});\n\n$cancel.on('click',()=>{\n    $dialog.hide();\n});\n\n$clear.on('click',()=>{\n    mc.clear();\n    // mc.background().clear().draw(b64=>{\n    //     $result.attr('src',b64);\n    // });\n});\n\n$('.js-addImage').on('click',()=>{\n    let type = `image`;\n    showDialog(type,data.addImageOps);\n});\n\n$('.js-addWm').on('click',()=>{\n    let type = `watermark`;\n    showDialog(type,data.addWmOps);\n});\n\n$('.js-addText').on('click',()=>{\n    let type = `text`;\n    showDialog(type,data.addTextOps);\n});\n\n$sure.on('click',function(){\n    let ops = $(this).data('ops');\n    let type = $(this).data('type');\n    mcDraw(ops,type);\n});\n\nfunction mcDraw(ops,type){\n    switch (type) {\n        case `image`:\n            let img = new Image();\n            img.crossOrigin = '*';\n            img.onload = function(){\n                mc.add(img,ops.options).draw({\n                    type:'jpg',\n                    quality:.9,\n                    callback(b64){\n                        $result.attr('src',b64);\n                        $dialog.hide();\n                    },\n                });\n            };\n            img.src = ops.image;\n            break;\n        case `watermark`:\n            mc.watermark(ops.image,ops.options).draw(b64=>{\n                $result.attr('src',b64);\n                $dialog.hide();\n            });\n            break;\n        case `text`:\n            mc.text(ops.text,ops.options).draw(b64=>{\n                $result.attr('src',b64);\n                $dialog.hide();\n            });\n            break;\n        default:\n\n    }\n\n}\n\nfunction showDialog(type,ops){\n    let tab = `&nbsp;&nbsp;&nbsp;&nbsp;`;\n    let html;\n    switch (type) {\n        case 'image':\n            html = `<li>image:'${ops.image}'</li>\n                    <li>options:{</li>\n                    <li>${tab}width:<input data-type='width' class='js-input input' type='text' value='${ops.options.width}'></li>\n                    <li>${tab}pos:{</li>\n                    <li>${tab+tab}x:<input data-type='x' class='js-input input' type='text' value='${ops.options.pos.x}'></li>\n                    <li>${tab+tab}y:<input data-type='y' class='js-input input' type='text' value='${ops.options.pos.y}'></li>\n                    <li>${tab+tab}scale:<input data-type='scale' class='js-input input' type='text' value='${ops.options.pos.scale}'></li>\n                    <li>${tab+tab}rotate:<input data-type='rotate' class='js-input input' type='text' value='${ops.options.pos.rotate}'></li>\n                    <li>${tab}}</li>\n                    <li>}</li>`;\n            break;\n        case 'watermark':\n            html = `<li>image:'${ops.image}'</li>\n                    <li>options:{</li>\n                    <li>${tab}width:<input data-type='width' class='js-input input' type='text' value='${ops.options.width}'></li>\n                    <li>${tab}pos:\n                        <select data-type='pos' class='js-select select'>\n                            <option>rightBottom</option>\n                            <option>rightTop</option>\n                            <option>leftBottom</option>\n                            <option>leftTop</option>\n                        </select>\n                    <li>}</li>`;\n            break;\n        case 'text':\n            html = `<li>text:<span style=\"font-size:12px;\">''&lt;b&gt;美图&lt;/b&gt;前端组啊啊啊啊&lt;s&gt;MCanvas.js&lt;/s&gt;''</span></li>\n                    <li>options:{</li>\n                    <li>${tab}width:<input data-type='width' class='js-input input' type='text' value='${ops.options.width}'></li>\n                    <li>${tab}align:\n                        <select data-type='align' class='js-select select'>\n                            <option>left</option>\n                            <option>center</option>\n                            <option>right</option>\n                        </select>\n                    </li>\n                    <li>${tab}pos:{\n                    <li>${tab+tab}x:<input data-type='x' class='js-input input' type='text' value='${ops.options.pos.x}'></li>\n                    <li>${tab+tab}y:<input data-type='y' class='js-input input' type='text' value='${ops.options.pos.y}'></li>\n                    <li>${tab}}</li>\n                    <li>}</li>`;\n            break;\n        default:\n    }\n    $params.html(html);\n    $sure.data('ops',JSON.stringify(ops)).data('type',type);\n    $dialog.show();\n}\n\n$(window).on('input','.js-input',function(){\n    let $this = $(this);\n    let v = $this.val();\n    let type = $this.data('type');\n    let ops = $sure.data('ops');\n    switch (type) {\n        case 'width':\n            ops.options.width = v;\n            break;\n        case 'x':\n            ops.options.pos.x = v;\n            break;\n        case 'y':\n            ops.options.pos.y = v;\n            break;\n        case 'scale':\n            ops.options.pos.scale = v;\n            break;\n        case 'rotate':\n            ops.options.pos.rotate = v;\n            break;\n        case 'align':\n            ops.options.align = v;\n            break;\n        default:\n    }\n    $sure.data('ops',JSON.stringify(ops));\n});\n\n$(window).on('focus','.js-input',function(){\n    $(this).addClass('focus');\n});\n$(window).on('blur','.js-input',function(){\n    $(this).removeClass('focus');\n});\n\n$(window).on('change','.js-select',function(){\n    let ops = $sure.data('ops');\n    let type = $(this).data('type');\n    ops.options[type] = $(this).val();\n    $sure.data('ops',JSON.stringify(ops));\n});\n// let img = new Image();\n// img.onload = ()=>{\n    // mc.background({\n    //     image:'http://mtapplet.meitudata.com/596c72073971d86b5128.jpg',\n    //     left:0,\n    //     top:0,\n    //     color:'#000000',\n    //     type:'origin',\n    // }).add([{\n    //     image:'images/ear.png',\n    //     options:{\n    //         width:482,\n    //         pos:{\n    //             x:150,\n    //             y:58,\n    //             scale:1,\n    //             rotate:1,\n    //         },\n    //     },\n    // },{\n    //     image:'images/neck.png',\n    //     options:{\n    //         width:277,\n    //         pos:{\n    //             x:213,\n    //             y:557,\n    //             scale:1,\n    //             rotate:1,\n    //         },\n    //     },\n    // }]).add('images/nose.png',{\n    //     width:183,\n    //     pos:{\n    //         x:250,\n    //         y:369,\n    //         scale:0.84,\n    //         rotate:1,\n    //     },\n    // }).text('郭晓东<br><s>啊啊啊</s>我<br>我我<br><b>哦哦哦</b><s>啦啦啦</s>',{\n    //     width:'300px',\n    //     align:'center',\n    //     pos:{\n    //         x:0,\n    //         y:0,\n    //     },\n    // }).watermark(img ,{\n    //     width:'40%',\n    //     pos:'rightBottom',\n    // }).draw( b64 =>{\n    //     $('.js-result').attr('src',b64);\n    // });\n// };\n// img.src = 'images/watermark.jpg';\n"],"names":["obj1","obj2","k","hasOwnProperty","extend","image","loaded","error","img","Image","indexOf","crossOrigin","onload","onerror","src","arr","Object","prototype","toString","call","cbk","loadImage","log","err","obj","UA","window","navigator","userAgent","toLowerCase","IOS","test","IPAD","match","MCanvas","cwidth","cheight","backgroundColor","ops","canvas","ctx","queue","end","textData","bgConfig","_init","document","createElement","width","height","getContext","fillStyle","fillRect","background","bg","push","color","getImage","_background","_getBgAlign","left","iw","cw","cropScale","rv","Math","abs","_getSize","ih","iRatio","cRatio","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","type","top","drawImage","_next","watermark","pos","margin","position","x","y","add","options","def","_","isArr","forEach","v","_add","_handleOps","console","warn","cdx","cdy","cdw","cdh","crop","lsx","lsy","lsw","lsh","cratio","ldx","ldy","ldw","ldh","lcvs","lctx","_ratio","lctxScale","spaceX","spaceY","shrink","isIos8","round","map","translate","rotate","scale","tagName","naturalWidth","naturalHeight","offsetWidth","offsetHeight","ch","ratio","_get","maxLsw","maxLsh","cropx","cropy","cropw","croph","px","py","pr","ps","parseFloat","PI","text","context","fontFamily","size","option","_text","_parse","split","result","i","length","value","splitTag","tmp","textArr","style","line","lineheight","getLineHeight","font","measureText","replace","fontLength","forin","lineWidth","align","data","_fillText","lh","vlh","textAlign","textBaseline","fillText","par","child","str","draw","b64","_ops","callback","toDataURL","quality","shift","clear","clearRect","$sure","$","$params","$dialog","$result","$cancel","$clear","mc","timer","on","addClass","setTimeout","removeClass","hide","addImageOps","addWmOps","addTextOps","mcDraw","attr","showDialog","tab","html","JSON","stringify","show","$this","val"],"mappings":"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"}